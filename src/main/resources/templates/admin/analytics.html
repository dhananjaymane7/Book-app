<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - BookStore Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --background: #ffffff;
            --foreground: #1f2937;
            --card: #f1f5f9;
            --card-foreground: #1f2937;
            --primary: #8b5cf6;
            --primary-foreground: #ffffff;
            --secondary: #6b7280;
            --muted: #f1f5f9;
            --muted-foreground: #6b7280;
            --accent: #8b5cf6;
            --border: #e5e7eb;
            --chart-1: #4f46e5;
            --chart-2: #3b82f6;
            --chart-3: #10b981;
            --chart-4: #f59e0b;
            --chart-5: #dc2626;
            --sidebar: #1f2937;
            --sidebar-foreground: #ffffff;
            --sidebar-accent: #8b5cf6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar);
            color: var(--sidebar-foreground);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 1.5rem;
            color: white;
        }

        .sidebar-nav {
            padding: 2rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 2rem;
            color: var(--sidebar-foreground);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(139, 92, 246, 0.1);
            border-left-color: var(--sidebar-accent);
            color: var(--sidebar-accent);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
            fill: currentColor;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            background-color: var(--muted);
        }

        .header {
            background-color: var(--background);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.75rem;
            color: var(--foreground);
        }

        .date-filter {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background-color: var(--background);
            color: var(--foreground);
            font-size: 0.875rem;
        }

        .content-area {
            padding: 2rem;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background-color: var(--background);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .kpi-title {
            font-size: 0.875rem;
            color: var(--muted-foreground);
            font-weight: 500;
        }

        .kpi-icon {
            width: 24px;
            height: 24px;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: var(--muted);
        }

        .kpi-value {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 2rem;
            color: var(--foreground);
            margin-bottom: 0.5rem;
        }

        .kpi-change {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }

        .kpi-change.positive {
            color: var(--chart-3);
        }

        .kpi-change.negative {
            color: var(--chart-5);
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background-color: var(--background);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--foreground);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Data Table */
        .table-card {
            background-color: var(--background);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            font-weight: 600;
            color: var(--muted-foreground);
            font-size: 0.875rem;
            background-color: var(--muted);
        }

        .data-table tr:hover {
            background-color: var(--muted);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-completed {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--chart-3);
        }

        .status-pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--chart-4);
        }

        .status-cancelled {
            background-color: rgba(220, 38, 38, 0.1);
            color: var(--chart-5);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 1rem;
            }

            .content-area {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
<div class="dashboard-container">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">BookStore Pro Analytics</div>
        </div>
        <div class="sidebar-nav">
            <a href="/admin" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                Dashboard
            </a>
            <a href="/admin/analytics" class="nav-item active">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                </svg>
                Analytics
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <h1 class="header-title">Analytics Dashboard</h1>
            <div class="date-filter">
                <select class="filter-select" id="dateRange">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="365">Last year</option>
                </select>
                <select class="filter-select" id="categoryFilter">
                    <option value="all">All Categories</option>
                    <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}">Fiction</option>
                </select>
            </div>
        </header>

        <!-- Content Area -->
        <div class="content-area">
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-title">Total Revenue</span>
                        <div class="kpi-icon" style="background-color: rgba(79, 70, 229, 0.1);">
                            <svg style="color: var(--chart-1);" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="kpi-value" th:text="${totalRevenue != null ? '$' + #numbers.formatDecimal(totalRevenue, 0, 'COMMA', 2, 'POINT') : '₹9,230'}">₹45,231.89</div>
                    <div class="kpi-change positive">
                        <span>+20.1% from last month</span>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-title">Total Orders</span>
                        <div class="kpi-icon" style="background-color: rgba(59, 130, 246, 0.1);">
                            <svg style="color: var(--chart-2);" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="kpi-value" th:text="${totalOrders != null ? totalOrders : '52'}">2,350</div>
                    <div class="kpi-change positive">
                        <span>+180.1% from last month</span>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-title">Books Sold</span>
                        <div class="kpi-icon" style="background-color: rgba(16, 185, 129, 0.1);">
                            <svg style="color: var(--chart-3);" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="kpi-value" th:text="${booksSold != null ? booksSold : '55'}">12,234</div>
                    <div class="kpi-change positive">
                        <span>+19% from last month</span>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <span class="kpi-title">Active Customers</span>
                        <div class="kpi-icon" style="background-color: rgba(245, 158, 11, 0.1);">
                            <svg style="color: var(--chart-4);" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="kpi-value" th:text="${activeCustomers != null ? activeCustomers : '18'}">573</div>
                    <div class="kpi-change positive">
                        <span>+2 since last hour</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Revenue Trend</h3>
                        <select class="filter-select">
                            <option>Last 30 days</option>
                            <option>Last 90 days</option>
                            <option>Last year</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Top Categories</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Orders Table -->
            <div class="table-card">
                <div class="table-header">
                    <h3 class="chart-title">Recent Orders</h3>
                    <a href="/admin/orders" style="color: var(--primary); text-decoration: none; font-weight: 500;">View all</a>
                </div>
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Book</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="order : ${recentOrders}">
                        <td th:text="${order.id}">#3210</td>
                        <td th:text="${order.customerName}">John Doe</td>
                        <td th:text="${order.bookTitle}">The Great Gatsby</td>
                        <td th:text="'$' + ${order.amount}">₹16.00</td>
                        <td>
                                    <span th:class="'status-badge status-' + ${order.status.toLowerCase()}"
                                          th:text="${order.status}">Completed</span>
                        </td>
                        <td th:text="${#dates.format(order.orderDate, 'MMM dd, yyyy')}">Oct 15, 2023</td>
                    </tr>
                    <!-- Fallback static data if no orders -->
                    <tr th:if="${#lists.isEmpty(recentOrders)}">
                        <td>#3210</td>
                        <td>John Doe</td>
                        <td>The Great Gatsby</td>
                        <td>₹16.00</td>
                        <td><span class="status-badge status-completed">Completed</span></td>
                        <td>Oct 15, 2023</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(recentOrders)}">
                        <td>#3209</td>
                        <td>Jane Smith</td>
                        <td>To Kill a Mockingbird</td>
                        <td>₹14.99</td>
                        <td><span class="status-badge status-pending">Pending</span></td>
                        <td>Oct 15, 2023</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(recentOrders)}">
                        <td>#3208</td>
                        <td>Mike Johnson</td>
                        <td>1984</td>
                        <td>₹13.99</td>
                        <td><span class="status-badge status-completed">Completed</span></td>
                        <td>Oct 14, 2023</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<script>
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Revenue',
                data: [12000, 19000, 15000, 25000, 22000, 30000, 28000, 35000, 32000, 40000, 38000, 45000],
                borderColor: 'rgb(79, 70, 229)',
                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '₹' + value.toLocaleString();
                        }
                    }
                }
            }
        }
    });

    // Category Chart
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    const categoryChart = new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
            labels: ['Fiction', 'Non-Fiction', 'Science', 'History', 'Biography'],
            datasets: [{
                data: [35, 25, 20, 12, 8],
                backgroundColor: [
                    'rgb(79, 70, 229)',
                    'rgb(59, 130, 246)',
                    'rgb(16, 185, 129)',
                    'rgb(245, 158, 11)',
                    'rgb(220, 38, 38)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Filter functionality
    document.getElementById('dateRange').addEventListener('change', function() {
        // Add your filter logic here
        console.log('Date range changed to:', this.value);
    });

    document.getElementById('categoryFilter').addEventListener('change', function() {
        // Add your filter logic here
        console.log('Category filter changed to:', this.value);
    });
</script>
</body>
</html>
